{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){return function(){var Super=_getPrototypeOf(Derived),result;if(_isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React,{Component}from'react';import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import{FlatList,ListItem,Icon,Badge}from'react-native-elements';import{RFValue}from'react-native-responsive-fontsize';import firebase from'firebase';import db from\"../config\";import MyHeader from\"../components/MyHeader\";var MyDonationsScreen=function(_Component){_inherits(MyDonationsScreen,_Component);var _super=_createSuper(MyDonationsScreen);function MyDonationsScreen(){var _this;_classCallCheck(this,MyDonationsScreen);_this=_super.call(this);_this.getAllDonations=function(){_this.requestRef=db.collection('allDonations').where(donerID=_this.state.userID).onSnapshot(function(snapshot){var allDonations=snapshot.docs.map(function(document){return document.data();});_this.setState({allDonations:allDonations});});};_this.sendNotification=function(bookdetails,requestStatus){var requestID=book.details.request_id;var donerID=book.details.doner_id;db.collection('all_notifications').where('request_id','==',requestID).where('doner_id','==',donerID).get().then(function(snapshot){snapshot.forEach(function(doc){var message='';if(requestStatus==='bookSent'){message=_this.state.donerName+' sent you a book';}else{message=_this.state.donerName+' has shown interest in donating a book';}db.collection('all_notifications').doc(doc.id).update({'message':message,notification_status:'unread',date:firebase.firestore.FieldValue.serverTimestamp()});});});};_this.sendBook=function(bookDetails){if(bookDetails.request_status===\"Book Sent\"){var requestStatus=\"Donor Interested\";db.collection(\"all_donations\").doc(bookDetails.doc_id).update({\"request_status\":\"Donor Interested\"});_this.sendNotification(bookDetails,requestStatus);}else{var requestStatus=\"Book Sent\";db.collection(\"all_donations\").doc(bookDetails.doc_id).update({\"request_status\":\"Book Sent\"});_this.sendNotification(bookDetails,requestStatus);}};_this.keyExtractor=function(item,index){return index.toString();};_this.renderItem=function(_ref){var item=_ref.item,i=_ref.i;return React.createElement(ListItem,{key:i,title:item.book_name,subtitle:'Requested By:'+item.requested_by+'\\nStatus:'+item.request_status,leftElement:React.createElement(Icon,{name:\"book\",type:\"font-awesome\",color:\"#696969\"}),titleStyle:{color:'black',fontWeight:'bold'},rightElement:React.createElement(TouchableOpacity,{style:styles.button,onPress:function onPress(){_this.sendBook(item);}},React.createElement(Text,{style:{color:'#ffff'}},\" Send Book \")),bottomDivider:true});};_this.state={allDonations:[]};_this.requestRef=null;return _this;}_createClass(MyDonationsScreen,[{key:\"render\",value:function render(){return React.createElement(View,{style:{flex:1}},React.createElement(MyHeader,{navigation:this.props.navigation,title:\"My Donations\"}),React.createElement(View,{style:{flex:1}},this.state.allDonations.length===0?React.createElement(View,{style:styles.subtitle},React.createElement(Text,{style:{fontSize:20}},\" List of all book donations\")):React.createElement(FlatList,{keyExtractor:this.keyExtractor,data:this.state.allDonations,renderItem:this.renderItem})));}}]);return MyDonationsScreen;}(Component);export{MyDonationsScreen as default};var styles=StyleSheet.create({button:{width:100,height:30,justifyContent:'center',alignItems:'center',shadowColor:\"#000\",shadowOffset:{width:0,height:8},elevation:16},subtitle:{flex:1,fontSize:20,justifyContent:'center',alignItems:'center'}});","map":{"version":3,"sources":["C:/Users/aines/Desktop/book-santa-stage-11-master/screens/MyDonationsScreen.js"],"names":["React","Component","FlatList","ListItem","Icon","Badge","RFValue","firebase","db","MyHeader","MyDonationsScreen","getAllDonations","requestRef","collection","where","donerID","state","userID","onSnapshot","snapshot","allDonations","docs","map","document","data","setState","sendNotification","bookdetails","requestStatus","requestID","book","details","request_id","doner_id","get","then","forEach","doc","message","donerName","id","update","notification_status","date","firestore","FieldValue","serverTimestamp","sendBook","bookDetails","request_status","doc_id","keyExtractor","item","index","toString","renderItem","i","book_name","requested_by","color","fontWeight","styles","button","flex","props","navigation","length","subtitle","fontSize","StyleSheet","create","width","height","justifyContent","alignItems","shadowColor","shadowOffset","elevation"],"mappings":"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","sourcesContent":["import React , {Component} from 'react';\r\nimport {View,Text,TouchableOpacity,StyleSheet} from 'react-native';\r\nimport {FlatList,ListItem,Icon,Badge} from 'react-native-elements';\r\nimport {RFValue} from 'react-native-responsive-fontsize';\r\nimport firebase from 'firebase';\r\nimport db from '../config'\r\nimport MyHeader from '../components/MyHeader';\r\nexport default class MyDonationsScreen extends Component{\r\nconstructor(){\r\n    super()\r\n    this.state={\r\n        allDonations:[],\r\n\r\n    }\r\n    this.requestRef=null\r\n} \r\n getAllDonations=()=>{\r\n this.requestRef=db.collection('allDonations').where(donerID=this.state.userID)\r\n .onSnapshot((snapshot)=>{\r\n     var allDonations=snapshot.docs.map(document=>document.data());\r\n     this.setState({\r\n         allDonations:allDonations\r\n     })                                                                                  \r\n })\r\n\r\n}\r\n\r\nsendNotification=(bookdetails,requestStatus)=>{\r\nvar requestID=book.details.request_id\r\nvar donerID=book.details.doner_id\r\ndb.collection('all_notifications').where('request_id','==',requestID)\r\n.where('doner_id','==',donerID)\r\n.get()\r\n.then((snapshot)=>{\r\n    snapshot.forEach((doc)=>{\r\n     var message=''\r\n     if(requestStatus==='bookSent'){\r\n         message=this.state.donerName+' sent you a book'\r\n     }\r\n     else{\r\n         message=this.state.donerName+' has shown interest in donating a book'\r\n     }\r\n     db.collection('all_notifications').doc(doc.id).update({\r\n         'message':message,\r\n         notification_status:'unread',\r\n         date:firebase.firestore.FieldValue.serverTimestamp()\r\n     })\r\n    })\r\n})\r\n}\r\nsendBook=(bookDetails)=>{\r\n     if(bookDetails.request_status === \"Book Sent\"){ \r\n         var requestStatus = \"Donor Interested\" \r\n         db.collection(\"all_donations\").doc(bookDetails.doc_id).update({\r\n              \"request_status\" : \"Donor Interested\" \r\n            }) \r\n            this.sendNotification(bookDetails,requestStatus) \r\n        } \r\n        else{ \r\n            var requestStatus = \"Book Sent\" \r\n            db.collection(\"all_donations\").doc(bookDetails.doc_id).update({\r\n                 \"request_status\" : \"Book Sent\"\r\n                 }) \r\n                 this.sendNotification(bookDetails,requestStatus)\r\n                 } }\r\n\r\nkeyExtractor=(item,index)=>index.toString()\r\nrenderItem=({item,i})=>(\r\n    <ListItem \r\n    key={i}\r\n    title={item.book_name}\r\n    subtitle={'Requested By:'+ item.requested_by + '\\nStatus:'+ item.request_status }\r\n    leftElement={\r\n    <Icon name=\"book\" type=\"font-awesome\" color ='#696969'/>} \r\n    titleStyle={{ \r\n        color: 'black', fontWeight: 'bold'\r\n         }}\r\n rightElement={ \r\n         <TouchableOpacity style={styles.button}\r\n                          onPress={()=>{\r\n                              this.sendBook(item)\r\n                          }}>\r\n             <Text style={{color:'#ffff'}} > Send Book </Text>\r\n         </TouchableOpacity>\r\n          }\r\n          bottomDivider\r\n          />      \r\n)\r\n\r\n\r\n render(){\r\n     return(\r\n         <View style={{flex:1}} >\r\n             <MyHeader navigation={this.props.navigation}\r\n                       title='My Donations'/>\r\n             <View style={{flex:1}} >\r\n                 {\r\n                     this.state.allDonations.length===0\r\n                     ?(\r\n                         <View style={styles.subtitle} > \r\n                         <Text style={{fontSize:20}} > List of all book donations</Text>\r\n                         </View>\r\n                     )\r\n                     :(\r\n                         <FlatList keyExtractor={this.keyExtractor}\r\n                                   data={this.state.allDonations}\r\n                                   renderItem={this.renderItem} />\r\n                     )\r\n                 }\r\n             </View>\r\n\r\n         </View>\r\n         \r\n     )\r\n }\r\n}\r\nvar styles = StyleSheet.create({\r\n    button:{\r\n         width:100, \r\n         height:30, \r\n         justifyContent:'center', \r\n         alignItems:'center', \r\n         shadowColor: \"#000\", \r\n         shadowOffset: { width: 0, height: 8 }, \r\n         elevation : 16 }, \r\nsubtitle :{ \r\n             flex:1,\r\n             fontSize: 20, \r\n             justifyContent:'center', \r\n             alignItems:'center'\r\n             }\r\n})"]},"metadata":{},"sourceType":"module"}