{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\aines\\\\Desktop\\\\book-santa-stage-11-master\\\\screens\\\\MyDonationsScreen.js\";\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport { FlatList, ListItem, Icon, Badge } from 'react-native-elements';\nimport firebase from 'firebase';\nimport db from \"../config\";\nimport MyHeader from \"../components/MyHeader\";\n\nvar MyDonationsScreen = function (_Component) {\n  _inherits(MyDonationsScreen, _Component);\n\n  var _super = _createSuper(MyDonationsScreen);\n\n  function MyDonationsScreen() {\n    var _this;\n\n    _classCallCheck(this, MyDonationsScreen);\n\n    _this = _super.call(this);\n\n    _this.getAllDonations = function () {\n      _this.requestRef = db.collection('allDonations').where(donerID = _this.state.userID).onSnapshot(function (snapshot) {\n        var allDonations = snapshot.docs.map(function (document) {\n          return document.data();\n        });\n\n        _this.setState({\n          allDonations: allDonations\n        });\n      });\n    };\n\n    _this.sendNotification = function (bookdetails, requestStatus) {\n      var requestID = book.details.request_id;\n      var donerID = book.details.doner_id;\n      db.collection('all_notifications').where('request_id', '==', requestID).where('doner_id', '==', donerID).get().then(function (snapshot) {\n        snapshot.forEach(function (doc) {\n          var message = '';\n\n          if (requestStatus === 'bookSent') {\n            message = _this.state.donerName + ' sent you a book';\n          } else {\n            message = _this.state.donerName + ' has shown interest in donating a book';\n          }\n\n          db.collection('all_notifications').doc(doc.id).update({\n            'message': message,\n            notification_status: 'unread',\n            date: firebase.firestore.FieldValue.serverTimestamp()\n          });\n        });\n      });\n    };\n\n    _this.sendBook = function (bookDetails) {\n      if (bookDetails.request_status === \"Book Sent\") {\n        var requestStatus = \"Donor Interested\";\n        db.collection(\"all_donations\").doc(bookDetails.doc_id).update({\n          \"request_status\": \"Donor Interested\"\n        });\n\n        _this.sendNotification(bookDetails, requestStatus);\n      } else {\n        var requestStatus = \"Book Sent\";\n        db.collection(\"all_donations\").doc(bookDetails.doc_id).update({\n          \"request_status\": \"Book Sent\"\n        });\n\n        _this.sendNotification(bookDetails, requestStatus);\n      }\n    };\n\n    _this.keyExtractor = function (item, index) {\n      return index.toString();\n    };\n\n    _this.renderItem = function (_ref) {\n      var item = _ref.item,\n          i = _ref.i;\n      return React.createElement(ListItem, {\n        key: i,\n        title: item.book_name,\n        subtitle: 'Requested By:' + item.requested_by + '\\nStatus:' + item.request_status,\n        leftElement: React.createElement(Icon, {\n          name: \"book\",\n          type: \"font-awesome\",\n          color: \"#696969\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 5\n          }\n        }),\n        titleStyle: {\n          color: 'black',\n          fontWeight: 'bold'\n        },\n        rightElement: React.createElement(TouchableOpacity, {\n          style: styles.button,\n          onPress: function onPress() {\n            _this.sendBook(item);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 10\n          }\n        }, React.createElement(Text, {\n          style: {\n            color: '#ffff'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 14\n          }\n        }, \" Send Book \")),\n        bottomDivider: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 5\n        }\n      });\n    };\n\n    _this.state = {\n      allDonations: []\n    };\n    _this.requestRef = null;\n    return _this;\n  }\n\n  _createClass(MyDonationsScreen, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement(View, {\n        style: {\n          flex: 1\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 10\n        }\n      }, React.createElement(MyHeader, {\n        navigation: this.props.navigation,\n        title: \"My Donations\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 14\n        }\n      }), React.createElement(View, {\n        style: {\n          flex: 1\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 14\n        }\n      }, this.state.allDonations.length === 0 ? React.createElement(View, {\n        style: styles.subtitle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 26\n        }\n      }, React.createElement(Text, {\n        style: {\n          fontSize: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 26\n        }\n      }, \" List of all book donations\")) : React.createElement(FlatList, {\n        keyExtractor: this.keyExtractor,\n        data: this.state.allDonations,\n        renderItem: this.renderItem,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 26\n        }\n      })));\n    }\n  }]);\n\n  return MyDonationsScreen;\n}(Component);\n\nexport { MyDonationsScreen as default };\nvar styles = StyleSheet.create({\n  button: {\n    width: 100,\n    height: 30,\n    justifyContent: 'center',\n    alignItems: 'center',\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 8\n    },\n    elevation: 16\n  },\n  subtitle: {\n    flex: 1,\n    fontSize: 20,\n    justifyContent: 'center',\n    alignItems: 'center'\n  }\n});","map":{"version":3,"sources":["C:/Users/aines/Desktop/book-santa-stage-11-master/screens/MyDonationsScreen.js"],"names":["React","Component","FlatList","ListItem","Icon","Badge","firebase","db","MyHeader","MyDonationsScreen","getAllDonations","requestRef","collection","where","donerID","state","userID","onSnapshot","snapshot","allDonations","docs","map","document","data","setState","sendNotification","bookdetails","requestStatus","requestID","book","details","request_id","doner_id","get","then","forEach","doc","message","donerName","id","update","notification_status","date","firestore","FieldValue","serverTimestamp","sendBook","bookDetails","request_status","doc_id","keyExtractor","item","index","toString","renderItem","i","book_name","requested_by","color","fontWeight","styles","button","flex","props","navigation","length","subtitle","fontSize","StyleSheet","create","width","height","justifyContent","alignItems","shadowColor","shadowOffset","elevation"],"mappings":"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","sourcesContent":["import React , {Component} from 'react';\r\nimport {View,Text,TouchableOpacity,StyleSheet} from 'react-native';\r\nimport {FlatList,ListItem,Icon,Badge} from 'react-native-elements';\r\nimport firebase from 'firebase';\r\nimport db from '../config'\r\nimport MyHeader from '../components/MyHeader';\r\nexport default class MyDonationsScreen extends Component{\r\nconstructor(){\r\n    super()\r\n    this.state={\r\n        allDonations:[],\r\n\r\n    }\r\n    this.requestRef=null\r\n} \r\n getAllDonations=()=>{\r\n this.requestRef=db.collection('allDonations').where(donerID=this.state.userID)\r\n .onSnapshot((snapshot)=>{\r\n     var allDonations=snapshot.docs.map(document=>document.data());\r\n     this.setState({\r\n         allDonations:allDonations\r\n     })\r\n })\r\n\r\n}\r\n\r\nsendNotification=(bookdetails,requestStatus)=>{\r\nvar requestID=book.details.request_id\r\nvar donerID=book.details.doner_id\r\ndb.collection('all_notifications').where('request_id','==',requestID)\r\n.where('doner_id','==',donerID)\r\n.get()\r\n.then((snapshot)=>{\r\n    snapshot.forEach((doc)=>{\r\n     var message=''\r\n     if(requestStatus==='bookSent'){\r\n         message=this.state.donerName+' sent you a book'\r\n     }\r\n     else{\r\n         message=this.state.donerName+' has shown interest in donating a book'\r\n     }\r\n     db.collection('all_notifications').doc(doc.id).update({\r\n         'message':message,\r\n         notification_status:'unread',\r\n         date:firebase.firestore.FieldValue.serverTimestamp()\r\n     })\r\n    })\r\n})\r\n}\r\nsendBook=(bookDetails)=>{\r\n     if(bookDetails.request_status === \"Book Sent\"){ \r\n         var requestStatus = \"Donor Interested\" \r\n         db.collection(\"all_donations\").doc(bookDetails.doc_id).update({\r\n              \"request_status\" : \"Donor Interested\" \r\n            }) \r\n            this.sendNotification(bookDetails,requestStatus) \r\n        } \r\n        else{ \r\n            var requestStatus = \"Book Sent\" \r\n            db.collection(\"all_donations\").doc(bookDetails.doc_id).update({\r\n                 \"request_status\" : \"Book Sent\"\r\n                 }) \r\n                 this.sendNotification(bookDetails,requestStatus)\r\n                 } }\r\n\r\nkeyExtractor=(item,index)=>index.toString()\r\nrenderItem=({item,i})=>(\r\n    <ListItem \r\n    key={i}\r\n    title={item.book_name}\r\n    subtitle={'Requested By:'+ item.requested_by + '\\nStatus:'+ item.request_status }\r\n    leftElement={\r\n    <Icon name=\"book\" type=\"font-awesome\" color ='#696969'/>} \r\n    titleStyle={{ \r\n        color: 'black', fontWeight: 'bold'\r\n         }}\r\n rightElement={ \r\n         <TouchableOpacity style={styles.button}\r\n                          onPress={()=>{\r\n                              this.sendBook(item)\r\n                          }}>\r\n             <Text style={{color:'#ffff'}} > Send Book </Text>\r\n         </TouchableOpacity>\r\n          }\r\n          bottomDivider\r\n          />      \r\n)\r\n\r\n\r\n render(){\r\n     return(\r\n         <View style={{flex:1}} >\r\n             <MyHeader navigation={this.props.navigation}\r\n                       title='My Donations'/>\r\n             <View style={{flex:1}} >\r\n                 {\r\n                     this.state.allDonations.length===0\r\n                     ?(\r\n                         <View style={styles.subtitle} > \r\n                         <Text style={{fontSize:20}} > List of all book donations</Text>\r\n                         </View>\r\n                     )\r\n                     :(\r\n                         <FlatList keyExtractor={this.keyExtractor}\r\n                                   data={this.state.allDonations}\r\n                                   renderItem={this.renderItem} />\r\n                     )\r\n                 }\r\n             </View>\r\n\r\n         </View>\r\n         \r\n     )\r\n }\r\n}\r\nvar styles = StyleSheet.create({\r\n    button:{\r\n         width:100, \r\n         height:30, \r\n         justifyContent:'center', \r\n         alignItems:'center', \r\n         shadowColor: \"#000\", \r\n         shadowOffset: { width: 0, height: 8 }, \r\n         elevation : 16 }, \r\nsubtitle :{ \r\n             flex:1,\r\n             fontSize: 20, \r\n             justifyContent:'center', \r\n             alignItems:'center'\r\n             }\r\n})"]},"metadata":{},"sourceType":"module"}